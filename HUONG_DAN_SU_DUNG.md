# HÆ°á»›ng Dáº«n Sá»­ Dá»¥ng - Há»‡ Thá»‘ng Cáº­p Nháº­t

## ğŸ‰ CÃ¡c TÃ­nh NÄƒng Má»›i

### 1. **Chatbot ÄÃ£ ÄÆ°á»£c Fix**
- âœ… Giao diá»‡n má»›i vá»›i mÃ u xanh lÃ¡ phÃ¹ há»£p theme cÃ¢y cáº£nh
- âœ… NÃºt chat trÃ²n Ä‘áº¹p máº¯t á»Ÿ gÃ³c dÆ°á»›i pháº£i mÃ n hÃ¬nh
- âœ… Cá»­a sá»• chat rá»™ng hÆ¡n, dá»… nhÃ¬n hÆ¡n
- âœ… Hiá»‡u á»©ng hover vÃ  animation mÆ°á»£t mÃ 

**CÃ¡ch sá»­ dá»¥ng:**
- Click vÃ o biá»ƒu tÆ°á»£ng ğŸ’¬ á»Ÿ gÃ³c dÆ°á»›i pháº£i
- Nháº­p tin nháº¯n vÃ  gá»­i cho admin
- Admin sáº½ tráº£ lá»i trá»±c tiáº¿p qua admin panel

### 2. **Tá»± Äá»™ng Trá»« Kho Khi BÃ¡n HÃ ng**
- âœ… Khi khÃ¡ch hÃ ng Ä‘áº·t hÃ ng, sá»‘ lÆ°á»£ng tá»“n kho tá»± Ä‘á»™ng giáº£m
- âœ… Ãp dá»¥ng cho cáº£ `san_pham.so_luong`
- âœ… CÃ³ log chi tiáº¿t trong error.log Ä‘á»ƒ kiá»ƒm tra

**Log máº«u:**
```
âœ… ÄÃ£ trá»« kho: Product ID=5, Sá»‘ lÆ°á»£ng=2, Order ID=123
```

**Kiá»ƒm tra:**
1. VÃ o **Admin â†’ Quáº£n LÃ½ Sáº£n Pháº©m** â†’ xem sá»‘ lÆ°á»£ng
2. KhÃ¡ch mua hÃ ng
3. F5 trang sáº£n pháº©m â†’ sá»‘ lÆ°á»£ng Ä‘Ã£ giáº£m

### 3. **Há»‡ Thá»‘ng Khuyáº¿n MÃ£i HoÃ n Chá»‰nh** â­

#### 3.1. Admin Quáº£n LÃ½ Khuyáº¿n MÃ£i

**Truy cáº­p:** `admin/qlkhuyenmai.php`

**Táº¡o mÃ£ khuyáº¿n mÃ£i:**
1. Click **"ThÃªm MÃ£ Khuyáº¿n MÃ£i"**
2. Äiá»n thÃ´ng tin:
   - **MÃ£ khuyáº¿n mÃ£i**: VD: `NEWYEAR2025` (viáº¿t hoa, khÃ´ng dáº¥u)
   - **TÃªn khuyáº¿n mÃ£i**: VD: "Khuyáº¿n mÃ£i Táº¿t 2025"
   - **Loáº¡i giáº£m giÃ¡**: Pháº§n trÄƒm (%) hoáº·c Sá»‘ tiá»n (Ä‘)
   - **GiÃ¡ trá»‹ giáº£m**: VD: 15 (náº¿u %), hoáº·c 50000 (náº¿u sá»‘ tiá»n)
   - **ÄÆ¡n tá»‘i thiá»ƒu**: VD: 500000 (Ä‘Æ¡n tá»« 500K má»›i Ä‘Æ°á»£c dÃ¹ng)
   - **Giáº£m tá»‘i Ä‘a**: VD: 200000 (giáº£m tá»‘i Ä‘a 200K cho mÃ£ %)
   - **Sá»‘ lÆ°á»£ng mÃ£**: Äá»ƒ trá»‘ng = khÃ´ng giá»›i háº¡n
   - **Ãp dá»¥ng cho**:
     - **Táº¥t cáº£ sáº£n pháº©m**: Má»i Ä‘Æ¡n hÃ ng Ä‘á»u dÃ¹ng Ä‘Æ°á»£c
     - **Theo danh má»¥c**: Chá»‰ sáº£n pháº©m thuá»™c danh má»¥c chá»n
     - **Theo sáº£n pháº©m**: Chá»‰ sáº£n pháº©m cá»¥ thá»ƒ Ä‘Æ°á»£c chá»n
   - **Thá»i gian**: Tá»« ngÃ y ... Ä‘áº¿n ngÃ y ...
   - **KÃ­ch hoáº¡t ngay**: Tick Ä‘á»ƒ mÃ£ hoáº¡t Ä‘á»™ng ngay

3. Click **"LÆ°u"**

**Quáº£n lÃ½ mÃ£:**
- âœï¸ **Sá»­a**: Click icon bÃºt chÃ¬
- ğŸ—‘ï¸ **XÃ³a**: Click icon thÃ¹ng rÃ¡c
- ğŸ”˜ **Báº­t/Táº¯t**: Toggle switch Ä‘á»ƒ báº­t/táº¯t mÃ£

**Thá»‘ng kÃª:**
- Sá»‘ láº§n Ä‘Ã£ sá»­ dá»¥ng
- Sá»‘ lÆ°á»£ng cÃ²n láº¡i (náº¿u cÃ³ giá»›i háº¡n)
- Tráº¡ng thÃ¡i: Äang hoáº¡t Ä‘á»™ng / Táº¡m dá»«ng / ÄÃ£ háº¿t háº¡n / Sáº¯p diá»…n ra

#### 3.2. KhÃ¡ch HÃ ng Sá»­ Dá»¥ng MÃ£

**Táº¡i trang giá» hÃ ng** (`giohang.php`):

1. ThÃªm sáº£n pháº©m vÃ o giá»
2. KÃ©o xuá»‘ng pháº§n **"MÃ£ giáº£m giÃ¡"**
3. Nháº­p mÃ£ khuyáº¿n mÃ£i (VD: `NEWYEAR2025`)
4. Click biá»ƒu tÆ°á»£ng ğŸ·ï¸ (tag)
5. Há»‡ thá»‘ng sáº½:
   - âœ… Kiá»ƒm tra mÃ£ cÃ³ tá»“n táº¡i khÃ´ng
   - âœ… Kiá»ƒm tra mÃ£ cÃ²n háº¡n khÃ´ng
   - âœ… Kiá»ƒm tra Ä‘Æ¡n hÃ ng Ä‘á»§ tá»‘i thiá»ƒu khÃ´ng
   - âœ… Kiá»ƒm tra sáº£n pháº©m cÃ³ Ã¡p dá»¥ng Ä‘Æ°á»£c khÃ´ng
   - âœ… TÃ­nh toÃ¡n giÃ¡ trá»‹ giáº£m
   - âœ… Hiá»ƒn thá»‹ badge mÃ£ Ä‘Ã£ Ã¡p dá»¥ng
   - âœ… Cáº­p nháº­t tá»•ng tiá»n

**VÃ­ dá»¥ hiá»ƒn thá»‹:**
```
âœ… NEWYEAR2025
   Khuyáº¿n mÃ£i Táº¿t 2025
   [XÃ³a]

Táº¡m tÃ­nh: 1.000.000Ä‘
Váº­n chuyá»ƒn: Miá»…n phÃ­
ğŸ·ï¸ Giáº£m giÃ¡ (NEWYEAR2025): -150.000Ä‘
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Tá»•ng cá»™ng: 850.000Ä‘
```

6. Click **"Tiáº¿n hÃ nh thanh toÃ¡n"**
7. Äiá»n thÃ´ng tin â†’ Äáº·t hÃ ng
8. MÃ£ khuyáº¿n mÃ£i sáº½ tá»± Ä‘á»™ng Ä‘Æ°á»£c ghi vÃ o Ä‘Æ¡n hÃ ng

#### 3.3. CÃ¡c Loáº¡i MÃ£ Khuyáº¿n MÃ£i

**1. MÃ£ giáº£m theo pháº§n trÄƒm (%)**
```
MÃ£: GIAM15
Giáº£m: 15%
ÄÆ¡n tá»‘i thiá»ƒu: 300.000Ä‘
Giáº£m tá»‘i Ä‘a: 100.000Ä‘

VÃ­ dá»¥:
- ÄÆ¡n 500.000Ä‘ â†’ Giáº£m 75.000Ä‘ (15%)
- ÄÆ¡n 1.000.000Ä‘ â†’ Giáº£m 100.000Ä‘ (max)
```

**2. MÃ£ giáº£m cá»‘ Ä‘á»‹nh (sá»‘ tiá»n)**
```
MÃ£: GIAM50K
Giáº£m: 50.000Ä‘
ÄÆ¡n tá»‘i thiá»ƒu: 200.000Ä‘

VÃ­ dá»¥:
- ÄÆ¡n 250.000Ä‘ â†’ Giáº£m 50.000Ä‘
- ÄÆ¡n 1.000.000Ä‘ â†’ Giáº£m 50.000Ä‘
```

**3. MÃ£ theo danh má»¥c**
```
MÃ£: CAYCáº¢NH20
Giáº£m: 20%
Ãp dá»¥ng: Chá»‰ danh má»¥c "CÃ¢y cáº£nh"

â†’ KhÃ¡ch mua cÃ¢y phong thá»§y â†’ KHÃ”NG Ä‘Æ°á»£c dÃ¹ng
â†’ KhÃ¡ch mua cÃ¢y cáº£nh â†’ ÄÆ°á»£c dÃ¹ng
```

**4. MÃ£ theo sáº£n pháº©m**
```
MÃ£: BONSAI100K
Giáº£m: 100.000Ä‘
Ãp dá»¥ng: Chá»‰ sáº£n pháº©m "CÃ¢y Bonsai"

â†’ Giá» hÃ ng cÃ³ Bonsai â†’ ÄÆ°á»£c dÃ¹ng
â†’ Giá» hÃ ng khÃ´ng cÃ³ Bonsai â†’ KHÃ”NG Ä‘Æ°á»£c dÃ¹ng
```

**5. MÃ£ cÃ³ giá»›i háº¡n sá»‘ lÆ°á»£ng**
```
MÃ£: FLASH50
Giáº£m: 50%
Sá»‘ lÆ°á»£ng: 100 mÃ£

â†’ 100 ngÆ°á»i Ä‘áº§u tiÃªn dÃ¹ng
â†’ NgÆ°á»i thá»© 101 â†’ Háº¿t lÆ°á»£t
```

## ğŸ“Š Cáº¥u TrÃºc Database

### Báº£ng `khuyen_mai`
```sql
id, ma_khuyen_mai, ten_khuyen_mai, mo_ta,
loai_giam (phan_tram/so_tien),
gia_tri_giam, gia_tri_don_toi_thieu, gia_tri_giam_toi_da,
so_luong_ma, so_lan_da_dung,
loai_ap_dung (tat_ca/danh_muc/san_pham),
ngay_bat_dau, ngay_ket_thuc, trang_thai
```

### Báº£ng `khuyen_mai_danh_muc`
```sql
id, khuyen_mai_id, danh_muc_id
```

### Báº£ng `khuyen_mai_san_pham`
```sql
id, khuyen_mai_id, san_pham_id
```

### Báº£ng `lich_su_khuyen_mai`
```sql
id, khuyen_mai_id, don_hang_id, nguoi_dung_id,
gia_tri_giam, ngay_su_dung
```

### Cá»™t má»›i trong `don_hang`
```sql
ALTER TABLE don_hang 
ADD COLUMN ma_khuyen_mai VARCHAR(50) DEFAULT NULL,
ADD COLUMN giam_gia DECIMAL(10,2) DEFAULT 0;
```

## ğŸš€ CÃ¡ch CÃ i Äáº·t

### BÆ°á»›c 1: Import SQL
```sql
-- Cháº¡y file nÃ y trong phpMyAdmin
mysql> source C:/xampp/htdocs/WebCN/database_khuyen_mai.sql
```

### BÆ°á»›c 2: Kiá»ƒm tra Files
```
âœ… admin/qlkhuyenmai.php
âœ… ajax_validate_promo.php
âœ… giohang.php (Ä‘Ã£ cáº­p nháº­t)
âœ… process_order.php (Ä‘Ã£ cáº­p nháº­t)
âœ… assets/chatbot.css (Ä‘Ã£ cáº­p nháº­t)
```

### BÆ°á»›c 3: Test Chatbot
1. VÃ o báº¥t ká»³ trang nÃ o (trangchu.php, san-pham.php...)
2. Kiá»ƒm tra gÃ³c dÆ°á»›i pháº£i cÃ³ nÃºt chat ğŸ’¬
3. Click vÃ o â†’ Cá»­a sá»• chat hiá»‡n ra
4. Gá»­i tin nháº¯n test

### BÆ°á»›c 4: Test Khuyáº¿n MÃ£i

**Táº¡o mÃ£ test:**
1. ÄÄƒng nháº­p Admin
2. VÃ o **Quáº£n LÃ½ Khuyáº¿n MÃ£i**
3. ThÃªm mÃ£: `TEST50K`, giáº£m 50.000Ä‘, Ä‘Æ¡n tá»‘i thiá»ƒu 100.000Ä‘
4. LÆ°u vÃ  kÃ­ch hoáº¡t

**DÃ¹ng mÃ£:**
1. ÄÄƒng xuáº¥t admin, Ä‘Äƒng nháº­p khÃ¡ch hÃ ng
2. ThÃªm sáº£n pháº©m vÃ o giá» (tá»•ng > 100K)
3. VÃ o giá» hÃ ng
4. Nháº­p mÃ£ `TEST50K` â†’ Click ğŸ·ï¸
5. Tháº¥y giáº£m 50.000Ä‘
6. Äáº·t hÃ ng
7. VÃ o **ÄÆ¡n hÃ ng cá»§a tÃ´i** â†’ Xem Ä‘Æ¡n vá»«a Ä‘áº·t
8. Quay láº¡i Admin â†’ **Quáº£n LÃ½ Khuyáº¿n MÃ£i**
9. Tháº¥y "ÄÃ£ sá»­ dá»¥ng: 1 láº§n"

### BÆ°á»›c 5: Test Trá»« Kho
1. Admin â†’ **Quáº£n LÃ½ Sáº£n Pháº©m**
2. Xem sáº£n pháº©m cÃ³ tá»“n kho = 10
3. KhÃ¡ch mua 3 sáº£n pháº©m Ä‘Ã³
4. F5 trang Quáº£n LÃ½ Sáº£n Pháº©m
5. Tá»“n kho cÃ²n 7 âœ…

## ğŸ› Troubleshooting

### 1. Chatbot khÃ´ng hiá»‡n?
- **Kiá»ƒm tra**: CÃ³ file `assets/chatbot.css` khÃ´ng?
- **Kiá»ƒm tra**: CÃ³ dÃ²ng `<script src="assets/chatbot.js">` trong footer khÃ´ng?
- **Fix**: F12 â†’ Console â†’ xem cÃ³ lá»—i JS khÃ´ng

### 2. MÃ£ khuyáº¿n mÃ£i khÃ´ng Ã¡p dá»¥ng Ä‘Æ°á»£c?
- âœ… Kiá»ƒm tra mÃ£ cÃ²n hiá»‡u lá»±c (ngÃ y báº¯t Ä‘áº§u - káº¿t thÃºc)
- âœ… Kiá»ƒm tra tráº¡ng thÃ¡i = "Äang hoáº¡t Ä‘á»™ng"
- âœ… Kiá»ƒm tra Ä‘Æ¡n hÃ ng Ä‘á»§ tá»‘i thiá»ƒu chÆ°a
- âœ… Kiá»ƒm tra sáº£n pháº©m cÃ³ thuá»™c loáº¡i Ã¡p dá»¥ng khÃ´ng
- âœ… F12 â†’ Network â†’ Xem response tá»« `ajax_validate_promo.php`

### 3. KhÃ´ng trá»« kho khi bÃ¡n?
- **Kiá»ƒm tra**: File `C:\xampp\apache\logs\error.log`
- **TÃ¬m**: DÃ²ng cÃ³ "âœ… ÄÃ£ trá»« kho" hoáº·c "âŒ KHO UPDATE FAILED"
- **NguyÃªn nhÃ¢n**: CÃ³ thá»ƒ sáº£n pháº©m khÃ´ng Ä‘á»§ tá»“n kho

### 4. Lá»—i SQL khi import?
```sql
-- Náº¿u lá»—i "Table already exists"
DROP TABLE IF EXISTS lich_su_khuyen_mai;
DROP TABLE IF EXISTS khuyen_mai_san_pham;
DROP TABLE IF EXISTS khuyen_mai_danh_muc;
DROP TABLE IF EXISTS khuyen_mai;

-- Sau Ä‘Ã³ cháº¡y láº¡i file SQL
```

### 5. Admin khÃ´ng tháº¥y menu "Khuyáº¿n MÃ£i"?
- **Kiá»ƒm tra**: File `admin/header.php` cÃ³ dÃ²ng:
```php
<a href="qlkhuyenmai.php" class="<?php echo ($current_page == 'promotions') ? 'active' : ''; ?>">
    <i class="fas fa-tags"></i>
    <span>Khuyáº¿n MÃ£i</span>
</a>
```

## ğŸ“ˆ Thá»‘ng KÃª & BÃ¡o CÃ¡o

### Xem mÃ£ Ä‘Ã£ dÃ¹ng bao nhiÃªu láº§n
```sql
SELECT 
    km.ma_khuyen_mai,
    km.ten_khuyen_mai,
    COUNT(lskm.id) as so_lan_su_dung,
    SUM(lskm.gia_tri_giam) as tong_da_giam
FROM khuyen_mai km
LEFT JOIN lich_su_khuyen_mai lskm ON km.id = lskm.khuyen_mai_id
GROUP BY km.id;
```

### Top khÃ¡ch hÃ ng dÃ¹ng mÃ£ nhiá»u nháº¥t
```sql
SELECT 
    nd.ho_ten,
    COUNT(lskm.id) as so_lan_dung_ma,
    SUM(lskm.gia_tri_giam) as tong_tiet_kiem
FROM lich_su_khuyen_mai lskm
INNER JOIN nguoi_dung nd ON lskm.nguoi_dung_id = nd.id
GROUP BY lskm.nguoi_dung_id
ORDER BY so_lan_dung_ma DESC
LIMIT 10;
```

### Doanh thu thá»±c táº¿ (sau giáº£m giÃ¡)
```sql
SELECT 
    SUM(tong_thanh_toan) as doanh_thu_thuc_te,
    SUM(giam_gia) as tong_da_giam,
    SUM(tong_tien) as doanh_thu_truoc_giam
FROM don_hang
WHERE trang_thai != 'ÄÃ£ há»§y';
```

## ğŸ’¡ Tips & Best Practices

### 1. Táº¡o mÃ£ khuyáº¿n mÃ£i hiá»‡u quáº£
- âœ… MÃ£ ngáº¯n gá»n, dá»… nhá»› (VD: `TET2025`, `FLASH50`)
- âœ… Äáº·t tÃªn mÃ´ táº£ rÃµ rÃ ng
- âœ… Giá»›i háº¡n thá»i gian Ä‘á»ƒ táº¡o cáº£m giÃ¡c khan hiáº¿m
- âœ… Äáº·t Ä‘Æ¡n tá»‘i thiá»ƒu há»£p lÃ½ (500K - 1.000K)
- âœ… Giáº£m tá»‘i Ä‘a Ä‘á»ƒ trÃ¡nh lá»— (100K - 200K)

### 2. Chiáº¿n lÆ°á»£c khuyáº¿n mÃ£i
- ğŸ“… **Theo mÃ¹a**: Táº¿t, 8/3, 20/10, Noel
- ğŸ¯ **Theo danh má»¥c**: Giáº£m cho cÃ¢y phong thá»§y vÃ o Ä‘áº§u nÄƒm
- ğŸ’ **VIP**: MÃ£ Ä‘áº·c biá»‡t cho khÃ¡ch hÃ ng thÃ¢n thiáº¿t
- âš¡ **Flash sale**: Giá»›i háº¡n sá»‘ lÆ°á»£ng (50 mÃ£ Ä‘áº§u tiÃªn)
- ğŸ **Freeship**: Giáº£m 30K phÃ­ ship cho Ä‘Æ¡n > 300K

### 3. Báº£o máº­t
- âŒ KhÃ´ng táº¡o mÃ£ dá»… Ä‘oÃ¡n (VD: `GIAM10`, `GIAM20`...)
- âœ… DÃ¹ng sá»‘ ngáº«u nhiÃªn (VD: `KM47B9`, `SALE93X2`)
- âœ… Giá»›i háº¡n sá»‘ láº§n dÃ¹ng / 1 khÃ¡ch
- âœ… Theo dÃµi log sá»­ dá»¥ng

## ğŸ“ Há»— Trá»£

Náº¿u gáº·p váº¥n Ä‘á»:
1. Kiá»ƒm tra `C:\xampp\apache\logs\error.log`
2. F12 â†’ Console â†’ Xem lá»—i JavaScript
3. F12 â†’ Network â†’ Xem AJAX request/response
4. Kiá»ƒm tra database cÃ³ Ä‘áº§y Ä‘á»§ báº£ng chÆ°a

---

**Táº¥t cáº£ Ä‘Ã£ sáºµn sÃ ng! ChÃºc báº¡n kinh doanh thÃ nh cÃ´ng! ğŸ‰**
